<h2>Precios de Platos</h2>

<div class="pricetable-container">
  <div *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>

  <table mat-table [dataSource]="listaPlatos" *ngIf="! sucursalesEmpty()" class="mat-elevation-z8">
      <ng-container matColumnDef="item" sticky>
        <th mat-header-cell *matHeaderCellDef>
          <mat-card-title>Lista</mat-card-title>
        </th>
        <td mat-cell *matCellDef="let plato" matColumnDef>
          <mat-card>
            <img src={{plato.imagenPlato}}>
            <mat-card-content>
              <span> {{plato.nombrePlato}}</span>
            </mat-card-content>
            <button mat-button title="Eliminar plato"><img class="remove-button" src="../../../assets/img/trash.png"></button>
          </mat-card>
        </td>
        <td mat-footer-cell *matFooterCellDef class="total">
          <mat-card-title> Resumen </mat-card-title>
          <mat-card-subtitle> Detalle de resumen </mat-card-subtitle>
        </td>
      </ng-container>

      <ng-container *ngFor="let sucursal of listaSucursalesOrdenadas; let i = index" matColumnDef="sucursal{{i+1}}">
        <div>
          <th mat-header-cell *matHeaderCellDef>
            <select matNativeControl class="form-control" required [(ngModel)]="sucursal"
                      (change)="cambiarSucursalSeleccionada(sucursal,i)">
              <option *ngFor="let suc of listaSucursales" [selected]="suc === sucursal" [ngValue]="suc">
                {{ suc.nombreSucursal }}
              </option>
            </select>
            <button mat-stroked-button (click)="openDialogInfo(sucursal)" title="Informacion sucursal" [ngClass]="{'mejorOp': sucursal.mejorOpcion}">
              <mat-card>
                <img class="cadena-logo" src="{{sucursal.imagenCadena}}">
                  <mat-card-content>
                    <mat-card-title>{{sucursal.direccion}}</mat-card-title>
                    <mat-card-subtitle>{{sucursal.nombreCadena}}</mat-card-subtitle>
                    <mat-card-subtitle> ( {{sucursal.productos.length}} ingredientes disponibles ) </mat-card-subtitle>
                  </mat-card-content>
              </mat-card>
            </button>
          </th>

          <td *matCellDef="let plato">
            <ul>
              <li [ngClass]="mayorCantidadProductosDisponibles(sucursal) ? 'cumpleCond' : 'noCumpleCond'">Mayor cantidad de ingredientes disponibles</li>
              <li [ngClass]="todosProductosDisponibles(sucursal) ? 'cumpleCond' : 'noCumpleCond'">Todos los ingredientes disponibles</li>
              <li [ngClass]="menorPrecioTotal(sucursal) ? 'cumpleCond' : 'noCumpleCond'">Menor precio total</li>
            </ul>
            <mat-expansion-panel>
              <mat-expansion-panel-header
              (opened)="panelDetallesOpenState = true"
              (closed)="panelDetallesOpenState = false">
                <mat-panel-description>
                    Ver detalles
                  </mat-panel-description>
              </mat-expansion-panel-header>
              <table mat-table [dataSource]="listaIngredientesPlato">
                  <ng-container matColumnDef="ingredienteColumnName">
                    <th mat-header-cell *matHeaderCellDef> Ingrediente </th>
                    <td mat-cell *matCellDef="let ing"> {{ing.nombreIngrediente}} </td>
                  </ng-container>
                  <ng-container matColumnDef="productoColumnName">
                    <th mat-header-cell *matHeaderCellDef> Producto </th>
                    <td mat-cell *matCellDef="let ing"> {{completarNombreProducto(sucursal,ing)}} </td>
                  </ng-container>
                  <ng-container matColumnDef="precioColumnName">
                    <th mat-header-cell *matHeaderCellDef> Precio </th>
                    <td mat-cell *matCellDef="let ing"> {{completarPrecioProducto(sucursal,ing.idIngrediente)}}</td>
                  </ng-container>
                  <tr mat-header-row *matHeaderRowDef="displayedColumns2"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns2;"></tr>
            </table>
            </mat-expansion-panel>

          </td>

          <td mat-footer-cell *matFooterCellDef>
            <mat-card [ngClass]="sucursal.mejorOpcion ? 'mejorOp' : 'total'">
              <mat-card-title> $ {{sucursal.total}} </mat-card-title>
               <img src="{{sucursal.imagenCadena}}">
              <mat-card-content>
                <mat-card-subtitle> {{sucursal.direccion}} </mat-card-subtitle>
              </mat-card-content>
            </mat-card>
          </td>
        </div>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <tr mat-footer-row *matFooterRowDef="displayedColumns; sticky: true"></tr>
  </table>

  <div class="noProds" *ngIf="error">
    <h4>Error al comparar precios</h4>
    <h5>Ocurrio un error al intentar comparar, vuelve a intentar.</h5>
  </div>
</div>

<div class="noCads" *ngIf="! error">
  <h4 *ngIf="(! loading) && (listaCadenasNoDisponibles)">No fue posible obtener precios de los supermercados</h4>
  <h5 *ngFor="let cadena of listaCadenasNoDisponibles">{{cadena.nombreCadena}}</h5>
</div>

<div class="sucursalesEmpty" *ngIf="error">
  <button mat-button [routerLink]="['/health']" routerLinkActive="router-link-active" ><img width="55" height="55" src="./../../../assets/img/health-food-icon2.png">Volver a saludable</button>
</div>
